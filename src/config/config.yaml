# PEECOM Configuration - ZeMA Hydraulic Systems Dataset
# Dataset: 2,205 cycles, 43,680 attributes per cycle

# Data configuration
data:
  dataset_dir: "dataset/cmohs"
  processed_dir: "output/processed_data" # Use output directory structure
  dataset_info:
    instances: 2205
    cycle_duration: 60 # seconds
    total_attributes: 43680
    sensors:
      pressure: 6 # PS1-PS6 (100Hz, 6000 attrs each)
      motor_power: 1 # EPS1 (100Hz, 6000 attrs)
      flow: 2 # FS1-FS2 (10Hz, 600 attrs each)
      temperature: 4 # TS1-TS4 (1Hz, 60 attrs each)
      vibration: 1 # VS1 (1Hz, 60 attrs)
      efficiency: 3 # CE, CP, SE (1Hz, 60 attrs each)

  # Data splits
  splits:
    train: 0.7
    val: 0.15
    test: 0.15

  # Target variables (profile.txt columns)
  targets:
    cooler_condition: 0 # Column 0: 3, 20, 100
    valve_condition: 1 # Column 1: 73, 80, 90, 100
    pump_leakage: 2 # Column 2: 0, 1, 2
    accumulator_pressure: 3 # Column 3: 90, 100, 115, 130
    stable_flag: 4 # Column 4: 0, 1

# Model configuration - adjusted for hydraulic system characteristics
model:
  input_timesteps: 60 # Match 60-second cycle duration
  input_features: 17 # Number of sensor types (after feature extraction)
  output_classes:
    cooler: 3 # 3 condition levels
    valve: 4 # 4 condition levels
    pump: 3 # 3 leakage levels
    accumulator: 4 # 4 pressure levels
    stability: 2 # Binary classification

  architecture:
    type: "multi_target_lstm"
    hidden_units: [128, 64, 32]
    dropout: 0.3
    l2_reg: 0.01
    use_attention: true
    use_physics_constraints: true

# Training configuration
training:
  epochs: 100
  batch_size: 32
  learning_rate: 0.001
  optimizer: "adam"
  early_stopping_patience: 10
  reduce_lr_patience: 5
  class_weight: "balanced"
  save_best_only: true

# Cross-validation configuration
cross_validation:
  folds: 5
  strategy: "stratified"
  shuffle: true

# Preprocessing configuration - Updated based on dataset analysis
preprocessing:
  # Feature extraction from high-frequency sensors
  feature_extraction:
    pressure_sensors: ["mean", "std", "min", "max", "skew", "kurtosis"]
    motor_power: ["mean", "std", "peak_power", "energy"]
    flow_sensors: ["mean", "std", "flow_rate_change"]
    temperature_sensors: ["mean", "std", "trend"]
    vibration: ["rms", "peak", "crest_factor"]
    efficiency: ["mean", "trend"]

  # Outlier detection and correction
  outlier_detection:
    enabled: true
    method: "isolation_forest"
    contamination: 0.1

  # Zero value handling based on analysis results
  zero_handling:
    # PS4: Critical - 66.68% zeros, replace with interpolation/correlation
    PS4:
      method: "correlation_interpolation"
      reference_sensors: ["PS1", "PS5", "PS6"] # Use good pressure sensors
      fallback_method: "median_filter"
      threshold: 0.1 # Consider values < 0.1 as zeros

    # PS2: Warning - 13.41% zeros, apply calibration correction
    PS2:
      method: "calibration_correction"
      zero_threshold: 0.1
      apply_drift_correction: true

    # PS3: Warning - 14.49% zeros, apply calibration correction
    PS3:
      method: "calibration_correction"
      zero_threshold: 0.1
      apply_drift_correction: true

    # FS1: Warning - 5.65% zeros, flow validation
    FS1:
      method: "flow_validation"
      reference_sensor: "FS2" # Use FS2 as reference (good sensor)
      validation_threshold: 0.2

    # SE1: Warning - 13.33% zeros, efficiency monitoring
    SE1:
      method: "efficiency_interpolation"
      pattern_detection: true
      periodic_correction: true

  # Sensor correction strategies
  sensor_correction:
    # Critical sensors requiring immediate correction
    critical_sensors: ["PS4"]
    warning_sensors: ["PS2", "PS3", "FS1", "SE1"]

    # PS4 specific correction (critical)
    PS4:
      enabled: true
      correction_method: "advanced_ensemble"
      reference_sensors: ["PS1", "PS3", "PS5", "PS6"]
      correlation_threshold: 0.8
      interpolation_method: "cubic"
      validate_corrections: true
      advanced_methods: ["correlation", "ml_imputation", "temporal", "physical"]

    # PS2/PS3 calibration correction
    pressure_calibration:
      enabled: true
      target_sensors: ["PS2", "PS3"]
      calibration_method: "drift_compensation"
      reference_period: "initialization" # Use first 100 samples as reference

    # Flow sensor validation
    flow_validation:
      enabled: true
      target_sensors: ["FS1"]
      reference_sensor: "FS2"
      validation_method: "cross_correlation"

    # Efficiency monitoring correction
    efficiency_correction:
      enabled: true
      target_sensors: ["SE1"]
      pattern_recognition: true
      periodic_pattern_length: 8 # Based on analysis findings

  # Data quality filters
  data_quality:
    # Remove samples with excessive zeros across multiple sensors
    max_zero_percentage: 50 # Reject samples with >50% zeros
    min_valid_sensors: 12 # Require at least 12/17 sensors to be valid

    # Sequence validation
    min_sequence_length: 30 # Minimum valid sequence length (50% of cycle)
    max_gap_length: 10 # Maximum acceptable gap in data

    # Cross-sensor validation
    pressure_consistency_check: true
    flow_balance_check: true
    temperature_gradient_check: true

  # Normalization (use robust for sensors with outliers)
  normalization:
    method: "robust" # robust, standard, minmax
    per_sensor_type: true
    handle_outliers: true
    outlier_method: "iqr" # Use IQR for outlier detection before normalization

# Analysis configuration
analysis:
  types: ["basic", "correlation", "health", "temporal", "fault_analysis"]
  generate_plots: true
  save_results: true
  plot_format: "png"
  output_dir: "output/analysis" # Save all analysis in output directory
  figures_dir: "output/figures" # Save all figures in output directory

  # Hydraulic-specific analysis
  hydraulic_analysis:
    pressure_analysis: true
    flow_analysis: true
    temperature_monitoring: true
    efficiency_tracking: true
    component_health_scoring: true

# Performance configuration
performance:
  use_gpu: false
  mixed_precision: false
  num_workers: 4
  memory_limit: 8 # GB
  batch_processing: true

# Output configuration
output:
  base_dir: "output"
  output_dir: "output" # For backward compatibility
  experiment_name: "hydraulic_condition_monitoring"
  subdirs:
    processed_data: "processed_data"
    models: "models"
    logs: "logs"
    analysis: "analysis"
    figures: "figures"
    predictions: "predictions"
    metrics: "metrics"
    checkpoints: "checkpoints"
    reports: "reports"

  # File saving options
  save_model: true
  save_predictions: true
  save_metrics: true
  save_analysis: true
  save_figures: true
  save_logs: true

  # Logging configuration
  log_level: "INFO"
  log_format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  log_to_file: true
  log_to_console: true

# Sensor specifications (ZeMA test rig) - Updated with health status
sensor_specs:
  PS1:
    type: "pressure"
    unit: "bar"
    sampling_rate: 100
    attributes_per_cycle: 6000
    expected_range: [0, 200]
    health_status: "Good"
    health_score: 100
    maintenance_priority: 3
    zero_percentage: 0.0

  PS2:
    type: "pressure"
    unit: "bar"
    sampling_rate: 100
    attributes_per_cycle: 6000
    expected_range: [0, 200]
    health_status: "Warning"
    health_score: 57.54
    maintenance_priority: 2
    zero_percentage: 13.41
    issues: ["High zero readings", "Extended zero sequences"]
    correction_needed: true

  PS3:
    type: "pressure"
    unit: "bar"
    sampling_rate: 100
    attributes_per_cycle: 6000
    expected_range: [0, 200]
    health_status: "Warning"
    health_score: 55.84
    maintenance_priority: 2
    zero_percentage: 14.49
    issues: ["High zero readings", "Extended zero sequences"]
    correction_needed: true

  PS4:
    type: "pressure"
    unit: "bar"
    sampling_rate: 100
    attributes_per_cycle: 6000
    expected_range: [0, 200]
    health_status: "Critical"
    health_score: 0
    maintenance_priority: 1
    zero_percentage: 66.68
    issues: ["Critical zero readings", "Extended zero sequences"]
    correction_needed: true # Known to have severe zero value issues
    requires_immediate_action: true

  PS5:
    type: "pressure"
    unit: "bar"
    sampling_rate: 100
    attributes_per_cycle: 6000
    expected_range: [0, 200]
    health_status: "Good"
    health_score: 100
    maintenance_priority: 3
    zero_percentage: 0.0

  PS6:
    type: "pressure"
    unit: "bar"
    sampling_rate: 100
    attributes_per_cycle: 6000
    expected_range: [0, 200]
    health_status: "Good"
    health_score: 100
    maintenance_priority: 3
    zero_percentage: 0.0

  EPS1:
    type: "motor_power"
    unit: "W"
    sampling_rate: 100
    attributes_per_cycle: 6000
    expected_range: [0, 5000]
    health_status: "Good"
    health_score: 100
    maintenance_priority: 3
    zero_percentage: 0.0

  FS1:
    type: "volume_flow"
    unit: "l/min"
    sampling_rate: 10
    attributes_per_cycle: 600
    expected_range: [0, 20]
    health_status: "Warning"
    health_score: 73.62
    maintenance_priority: 2
    zero_percentage: 5.65
    issues: ["Long zero sequences"]
    correction_needed: true

  FS2:
    type: "volume_flow"
    unit: "l/min"
    sampling_rate: 10
    attributes_per_cycle: 600
    expected_range: [0, 20]
    health_status: "Good"
    health_score: 100
    maintenance_priority: 3
    zero_percentage: 0.0

  TS1:
    type: "temperature"
    unit: "°C"
    sampling_rate: 1
    attributes_per_cycle: 60
    expected_range: [10, 80]
    health_status: "Good"
    health_score: 100
    maintenance_priority: 3
    zero_percentage: 0.0

  TS2:
    type: "temperature"
    unit: "°C"
    sampling_rate: 1
    attributes_per_cycle: 60
    expected_range: [10, 80]
    health_status: "Good"
    health_score: 100
    maintenance_priority: 3
    zero_percentage: 0.0

  TS3:
    type: "temperature"
    unit: "°C"
    sampling_rate: 1
    attributes_per_cycle: 60
    expected_range: [10, 80]
    health_status: "Good"
    health_score: 100
    maintenance_priority: 3
    zero_percentage: 0.0

  TS4:
    type: "temperature"
    unit: "°C"
    sampling_rate: 1
    attributes_per_cycle: 60
    expected_range: [10, 80]
    health_status: "Good"
    health_score: 100
    maintenance_priority: 3
    zero_percentage: 0.0

  VS1:
    type: "vibration"
    unit: "mm/s"
    sampling_rate: 1
    attributes_per_cycle: 60
    expected_range: [0, 10]
    health_status: "Good"
    health_score: 100
    maintenance_priority: 3
    zero_percentage: 0.0

  CE:
    type: "cooling_efficiency"
    unit: "%"
    sampling_rate: 1
    attributes_per_cycle: 60
    expected_range: [0, 100]
    virtual: true
    health_status: "Good"
    health_score: 100
    maintenance_priority: 3
    zero_percentage: 0.0

  CP:
    type: "cooling_power"
    unit: "kW"
    sampling_rate: 1
    attributes_per_cycle: 60
    expected_range: [0, 10]
    virtual: true
    health_status: "Good"
    health_score: 100
    maintenance_priority: 3
    zero_percentage: 0.0

  SE:
    type: "efficiency_factor"
    unit: "%"
    sampling_rate: 1
    attributes_per_cycle: 60
    expected_range: [0, 100]
    health_status: "Warning"
    health_score: 66.67
    maintenance_priority: 2
    zero_percentage: 13.33
    issues: ["High zero readings", "Periodic patterns"]
    correction_needed: true
